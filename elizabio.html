<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <script>window.sheetCsvUrl = "https://docs.google.com/spreadsheets/d/1iAi73leePAUecgtVYqUneI64RleFUV68N0gRVPJ5kus/export?format=csv&gid=539268331";</script>
  <script src="access_3_sheet.js" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Rakkas&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Platypi&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <title>elizabio</title>
</head>


<body>

  <div class="swipe"></div>

<div>
  <h1 style="color: #ec3ca2">ELIZA</h1>
  <h2 style="color: #68a870; font-style:italic;"">BIOLOGICAL/NATURAL ENDING</h2><br>
</div>
<!--CHART STUFF STARTS HERE-->
<div id="chart" class="pie2"
     role="img"
     style="
       --size:180px;
       --inner:48%;
       /* colors (your palette, same order as your gradient) */
       --c1:#68a870; --c2:#96d16f; --c3:#7b85b7;
       --s1: 0%; --s2: 0%; --s3: 100%;
       ">
  <span class="pie2__center"><p style="color: #68a870"><span data-cell="H2"></span>%</p></span>
</div>
<!--temp storage-->
<div id="sheet-values" hidden>
   <span data-cell="H2"></span>
   <span data-cell="H3"></span>
   <span data-cell="H4"></span>
</div>
<script>
// Wait for both DOM and sheet data
document.addEventListener("DOMContentLoaded", () => {
  // Check if sheetReady exists, if not wait for it
  const waitForSheet = () => {
    if (window.sheetReady) {
      return window.sheetReady;
    }
    // If not ready yet, wait a bit and check again
    return new Promise(resolve => {
      const checkInterval = setInterval(() => {
        if (window.sheetReady) {
          clearInterval(checkInterval);
          window.sheetReady.then(resolve);
        }
      }, 50);
    });
  };
  
  waitForSheet().then(() => {
    const pie2 = document.getElementById("chart");
    const spans = Array.from(document.querySelectorAll("#sheet-values [data-cell]"));
    
    // Parse and round values
    const values = spans.map(s => {
      const n = parseFloat(s.textContent);
      const val = Number.isFinite(n) ? Math.round(n * 10) / 10 : 0;
      s.textContent = val;
      return val;
    });
    
    console.log("Values:", values); // Should now be an array of numbers!
    
    // Compute cumulative stops
    let cumulative = 0;
    pie2.style.setProperty("--s1", "0%");
    values.forEach((v, i) => {
      cumulative += v;
      pie2.style.setProperty(`--s${i+1}`, cumulative + "%");  // FIXED: parenthesis before backtick
    });
    
    pie2.style.setProperty("--s3", "100%");
    
    const centerSpan = pie2.querySelector(".pie2__center [data-cell]");
    if(centerSpan){
      centerSpan.textContent = values[0];  // Note: changed to values[0] for H2, or use values[1] for H3
    }
    
    // Debug
    for (let i = 1; i <= 3; i++) {
      console.log(`--s${i}:`, pie2.style.getPropertyValue(`--s${i}`));  // FIXED: parenthesis before backticks
    }
  });
});
</script>
<!--whatever comes after the pie chart this way-->
  <p  style="font-style:italic">This is how often the company ELIZA reaches this type of reality. You just contributed to this.</p>
  <br>
  <p>A path of exponential progress leads to terraforming projects across Earth, increasing biodiversity and abundance across all biomes, maximizing the planet’s life’s energy efficiency. A few terraforming projects make it to our moon. It eventually shines a vibrant blue, its artificial atmosphere sheltering small oceans, vast swathes of vegetation, and rapidly evolving animals. 
</p>
  <br>
  <br>
  <a href="index.html" class="button">HOME</a>
  <br>
  <br>
</body>
</html>
